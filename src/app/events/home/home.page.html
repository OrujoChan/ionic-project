<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Home</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-refresher #refresher slot="fixed" (ionRefresh)="reloadEvents(refresher)">
    <ion-refresher-content>
    </ion-refresher-content>
  </ion-refresher>

  <div class="search-sort-container p-1">
    <div class="col-md-8">
      <div class="input-group">
        <input type="text" class="form-control" placeholder="Search events..." [(ngModel)]="search"
          (input)="reloadEvents()">
        <button class="btn btn-outline-secondary" type="button" (click)="reloadEvents()">
          <ion-icon name="search-outline"></ion-icon>
        </button>
      </div>
    </div>
    <div class="col-md-4 text-end">
      <button class="btn btn-primary me-2" (click)="orderBy.set('date')">Sort by Date
      </button>
      <button class="btn btn-primary me-2" (click)="orderBy.set('price')">Sort by Price
      </button>
      <button class="btn btn-primary" (click)="orderBy.set('distance')">Sort by Distance
      </button>
    </div>
  </div>

  @for(event of filteredEvents(); track event.id) {
  <ion-card>
    <a [routerLink]="['/events', event.id]">
      <ion-img [src]="getImageUrl(event.image) || 'assets/images/placeholder.jpg'" alt="Event Image"></ion-img>
    </a>

    <ion-card-header>
      <ion-card-title>
        <a [routerLink]="['/events', event.id]">{{ event.title }}</a>
      </ion-card-title>
      <ion-card-subtitle>{{ event.date | date : "dd/MM/yyyy" }}</ion-card-subtitle>
    </ion-card-header>

    <ion-card-content>
      <p>{{ event.description }}</p>

      <div class="event-info">
        <ion-avatar>
          <img [src]="getImageUrl(event.creator?.avatar) || 'assets/images/default-avatar.jpg'" alt="Creator Avatar" />
        </ion-avatar>
        <span>{{ event.creator?.name }}</span>
      </div>

      <div class="event-meta">
        <p>Distance: {{ event.distance | number: '1.2-2' }} km</p>
        <p>Price: {{ event.price | intlCurrency : "EUR" : "es-ES" }}</p>
      </div>

      <div class="event-attendance">
        <ion-button fill="clear" color="danger" *ngIf="event.mine" (click)="deleteEvent()">
          <ion-icon name="trash-outline"></ion-icon>
        </ion-button>

        <ion-button fill="clear" (click)="toggleAttend()">
          <ion-icon [name]="event.attend ? 'thumbs-up' : 'thumbs-down'"></ion-icon>
          {{ event.attend ? "I'm going" : "Not going" }}
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>
  }
</ion-content>